# PhotoBlock - System Architecture Diagrams
## Research Paper Diagrams Collection

---

## Diagram 1: High-Level System Architecture

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                              PHOTOBLOCK SYSTEM ARCHITECTURE                              │
└─────────────────────────────────────────────────────────────────────────────────────────┘

                                    ┌─────────────────┐
                                    │   END USER      │
                                    │   (Browser)     │
                                    └────────┬────────┘
                                             │
                                             │ HTTPS
                                             ▼
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                                   PRESENTATION LAYER                                     │
│  ┌─────────────────────────────────────────────────────────────────────────────────┐   │
│  │                           React.js Frontend (Vite)                               │   │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐        │   │
│  │  │   Upload     │  │   Gallery    │  │   Verify     │  │   Profile    │        │   │
│  │  │  Component   │  │  Component   │  │    Page      │  │    Page      │        │   │
│  │  └──────────────┘  └──────────────┘  └──────────────┘  └──────────────┘        │   │
│  │                                                                                  │   │
│  │  ┌─────────────────────────────────────────────────────────────────────────┐   │   │
│  │  │                        State Management (wagmi)                          │   │   │
│  │  │    • Wallet Connection    • Contract Reads    • Transaction States      │   │   │
│  │  └─────────────────────────────────────────────────────────────────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────────────────┘
         │                              │                              │
         │ Web3 RPC                     │ REST API                     │ REST API
         ▼                              ▼                              ▼
┌─────────────────────┐    ┌─────────────────────┐    ┌─────────────────────────────────┐
│   BLOCKCHAIN LAYER  │    │   STORAGE LAYER     │    │       DATABASE LAYER            │
│  ┌───────────────┐  │    │  ┌───────────────┐  │    │  ┌───────────────────────────┐  │
│  │   Ethereum    │  │    │  │     IPFS      │  │    │  │        Supabase           │  │
│  │   Network     │  │    │  │   Network     │  │    │  │     (PostgreSQL)          │  │
│  │               │  │    │  │               │  │    │  │                           │  │
│  │  • Localhost  │  │    │  │  • Pinata     │  │    │  │  • User Authentication    │  │
│  │    (31337)    │  │    │  │  • IPFS.io    │  │    │  │  • Profile Management     │  │
│  │  • Polygon    │  │    │  │  • Local Mock │  │    │  │  • Audit Logging          │  │
│  │    Amoy       │  │    │  │               │  │    │  │  • Session Tracking       │  │
│  │    (80002)    │  │    │  └───────────────┘  │    │  └───────────────────────────┘  │
│  └───────────────┘  │    └─────────────────────┘    └─────────────────────────────────┘
│         │           │              │                              │
│         ▼           │              ▼                              ▼
│  ┌───────────────┐  │    ┌───────────────────┐         ┌───────────────────┐
│  │ Smart Contract│  │    │  Distributed File │         │   Row Level       │
│  │  (Solidity)   │  │    │     Storage       │         │   Security (RLS)  │
│  │               │  │    │                   │         │                   │
│  │ • addCID()    │  │    │  • Immutable      │         │  • User Isolation │
│  │ • getCIDs()   │  │    │  • Content-       │         │  • Policy-based   │
│  │ • setUsername │  │    │    addressed      │         │    Access Control │
│  │ • getUsername │  │    │  • Redundant      │         │                   │
│  └───────────────┘  │    └───────────────────┘         └───────────────────┘
└─────────────────────┘
```

---

## Diagram 2: User Workflow - Photo Upload & Verification

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                         USER WORKFLOW: PHOTO UPLOAD & VERIFICATION                       │
└─────────────────────────────────────────────────────────────────────────────────────────┘

    ┌─────────┐
    │  START  │
    └────┬────┘
         │
         ▼
┌─────────────────┐     No      ┌─────────────────┐
│ Wallet Connected?├────────────►│  Connect Wallet │
└────────┬────────┘              │   (MetaMask)    │
         │ Yes                   └────────┬────────┘
         │◄──────────────────────────────┘
         ▼
┌─────────────────┐     No      ┌─────────────────┐
│ Correct Network? ├────────────►│  Switch Network │
│ (31337 or 80002)│              │   (Localhost/   │
└────────┬────────┘              │    Amoy)        │
         │ Yes                   └────────┬────────┘
         │◄──────────────────────────────┘
         ▼
┌─────────────────┐
│  Select Image   │
│   (File Input)  │
└────────┬────────┘
         │
         ▼
┌─────────────────┐              ┌─────────────────┐
│  Upload to IPFS │─────────────►│  IPFS Network   │
│  (Click Upload) │              │  (Pinata/Local) │
└────────┬────────┘              └────────┬────────┘
         │                                │
         │◄──────────CID Returned─────────┘
         ▼
┌─────────────────┐              ┌─────────────────┐
│ Save to Blockchain├────────────►│  Smart Contract │
│ (Click Save)    │              │   addCID(cid)   │
└────────┬────────┘              └────────┬────────┘
         │                                │
         ▼                                │
┌─────────────────┐              ┌────────▼────────┐
│  MetaMask Popup │              │  Transaction    │
│  (Sign & Confirm)│              │   Mining...     │
└────────┬────────┘              └────────┬────────┘
         │                                │
         │◄───────Tx Confirmed────────────┘
         ▼
┌─────────────────┐              ┌─────────────────┐
│  Photo Appears  │◄─────────────│  Blockchain     │
│   in Gallery    │   getCIDs()  │   Queried       │
└────────┬────────┘              └─────────────────┘
         │
         ▼
┌─────────────────┐              ┌─────────────────┐
│  Generate QR    │─────────────►│  Verification   │
│  Code (Verify)  │              │   URL Created   │
└────────┬────────┘              └─────────────────┘
         │
         ▼
    ┌─────────┐
    │   END   │
    └─────────┘
```

---

## Diagram 3: Smart Contract Architecture

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                            SMART CONTRACT ARCHITECTURE                                   │
└─────────────────────────────────────────────────────────────────────────────────────────┘

                              ┌─────────────────────────────┐
                              │     PhotoBlock Contract     │
                              │      (Solidity 0.8.19)      │
                              └─────────────────────────────┘
                                           │
                    ┌──────────────────────┼──────────────────────┐
                    │                      │                      │
                    ▼                      ▼                      ▼
         ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
         │     STORAGE     │    │    FUNCTIONS    │    │     EVENTS      │
         └─────────────────┘    └─────────────────┘    └─────────────────┘
                    │                      │                      │
                    ▼                      │                      │
┌───────────────────────────────┐          │                      │
│   mapping(address => UserInfo)│          │                      │
│                               │          │                      │
│   struct UserInfo {           │          │                      │
│     string username;          │          │                      │
│     string[] cidArray;        │          │                      │
│   }                           │          │                      │
└───────────────────────────────┘          │                      │
                                           │                      │
         ┌─────────────────────────────────┼──────────────────────┘
         │                                 │
         ▼                                 ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                              FUNCTION SIGNATURES                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  function setUsername(string memory _username) public               │   │
│  │  ────────────────────────────────────────────────────────────────── │   │
│  │  • Sets username for msg.sender                                     │   │
│  │  • Overwrites existing username                                     │   │
│  │  • Gas: ~45,000 (new) / ~25,000 (update)                           │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  function addCID(string memory _cid) public                         │   │
│  │  ────────────────────────────────────────────────────────────────── │   │
│  │  • Appends CID to user's cidArray                                   │   │
│  │  • No duplicate checking (intentional)                              │   │
│  │  • Gas: ~65,000 per CID                                             │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  function getUsername() public view returns (string memory)         │   │
│  │  ────────────────────────────────────────────────────────────────── │   │
│  │  • Returns username for msg.sender                                  │   │
│  │  • View function (no gas for calls)                                 │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  function getCIDs() public view returns (string[] memory)           │   │
│  │  ────────────────────────────────────────────────────────────────── │   │
│  │  • Returns all CIDs for msg.sender                                  │   │
│  │  • View function (no gas for calls)                                 │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
                                           │
                                           ▼
                    ┌─────────────────────────────────────────┐
                    │           DEPLOYMENT ADDRESSES           │
                    ├─────────────────────────────────────────┤
                    │  Localhost (31337):                      │
                    │  0x5FbDB2315678afecb367f032d93F642f64180aa3│
                    │                                          │
                    │  Polygon Amoy (80002):                   │
                    │  0x928cD9A5a8129D554F98104fF4a62f1D8aD01254│
                    └─────────────────────────────────────────┘
```

---

## Diagram 4: IPFS Storage Flow & Content Addressing

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                       IPFS STORAGE FLOW & CONTENT ADDRESSING                             │
└─────────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────┐
│  Original Image │
│   (photo.jpg)   │
│   Size: 2.5MB   │
└────────┬────────┘
         │
         │ Step 1: Upload Request
         ▼
┌─────────────────────────────────────────────────────────────────┐
│                      IPFS PINNING SERVICE                        │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │                    Content Processing                      │  │
│  │                                                            │  │
│  │   1. Receive binary data                                   │  │
│  │   2. Split into chunks (256KB each)                        │  │
│  │   3. Hash each chunk (SHA-256)                             │  │
│  │   4. Build Merkle DAG                                      │  │
│  │   5. Generate root CID                                     │  │
│  │                                                            │  │
│  └───────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
         │
         │ Step 2: CID Generation
         ▼
┌─────────────────────────────────────────────────────────────────┐
│                     CONTENT IDENTIFIER (CID)                     │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │                                                            │  │
│  │   CID: QmXoYPaxg8KpLma2Mfujwh9F7C2MsKknHwNqV9VC9QkBq     │  │
│  │        ├─┬────────────────────────────────────────────┤   │  │
│  │        │ │                                             │   │  │
│  │        │ └─► Base58 encoded multihash                  │   │  │
│  │        │                                               │   │  │
│  │        └───► Version prefix (Qm = CIDv0)               │   │  │
│  │                                                            │  │
│  │   Properties:                                              │  │
│  │   • Deterministic (same content = same CID)               │  │
│  │   • Immutable (CID changes if content changes)            │  │
│  │   • Self-verifying (CID can verify content integrity)     │  │
│  │                                                            │  │
│  └───────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
         │
         │ Step 3: Distributed Storage
         ▼
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                              IPFS DISTRIBUTED NETWORK                                    │
│                                                                                          │
│    ┌─────────┐         ┌─────────┐         ┌─────────┐         ┌─────────┐            │
│    │ Pinata  │         │ IPFS.io │         │Cloudflare│        │ Local   │            │
│    │  Node   │◄───────►│  Node   │◄───────►│  Node   │◄───────►│  Node   │            │
│    │         │   DHT   │         │   DHT   │         │   DHT   │         │            │
│    └─────────┘         └─────────┘         └─────────┘         └─────────┘            │
│         │                   │                   │                   │                  │
│         └───────────────────┴───────────────────┴───────────────────┘                  │
│                                      │                                                  │
│                           Distributed Hash Table                                        │
│                           (Content Discovery)                                           │
│                                                                                          │
└─────────────────────────────────────────────────────────────────────────────────────────┘
         │
         │ Step 4: Content Retrieval
         ▼
┌─────────────────────────────────────────────────────────────────┐
│                     GATEWAY FALLBACK SYSTEM                      │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │                                                            │  │
│  │   Priority Order:                                          │  │
│  │                                                            │  │
│  │   1. http://localhost:3001/ipfs/{CID}  ◄── Local (Dev)    │  │
│  │              │                                             │  │
│  │              ▼ Timeout (3s)                                │  │
│  │   2. https://ipfs.io/ipfs/{CID}                           │  │
│  │              │                                             │  │
│  │              ▼ Timeout (3s)                                │  │
│  │   3. https://cloudflare-ipfs.com/ipfs/{CID}               │  │
│  │              │                                             │  │
│  │              ▼ Timeout (3s)                                │  │
│  │   4. https://gateway.pinata.cloud/ipfs/{CID}              │  │
│  │                                                            │  │
│  └───────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
```

---

## Diagram 5: Authentication & Authorization Flow

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                        AUTHENTICATION & AUTHORIZATION FLOW                               │
└─────────────────────────────────────────────────────────────────────────────────────────┘

                              ┌─────────────────┐
                              │      USER       │
                              └────────┬────────┘
                                       │
              ┌────────────────────────┼────────────────────────┐
              │                        │                        │
              ▼                        ▼                        ▼
    ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
    │  Web3 Auth      │     │  Supabase Auth  │     │  Session Auth   │
    │  (Blockchain)   │     │  (Traditional)  │     │  (Combined)     │
    └────────┬────────┘     └────────┬────────┘     └────────┬────────┘
             │                       │                       │
             ▼                       ▼                       ▼
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                          │
│  WEB3 AUTHENTICATION                    SUPABASE AUTHENTICATION                         │
│  ════════════════════                   ═══════════════════════                         │
│                                                                                          │
│  ┌───────────────────┐                  ┌───────────────────┐                          │
│  │ 1. Connect Wallet │                  │ 1. Email/Password │                          │
│  │    (MetaMask)     │                  │    Registration   │                          │
│  └─────────┬─────────┘                  └─────────┬─────────┘                          │
│            │                                      │                                      │
│            ▼                                      ▼                                      │
│  ┌───────────────────┐                  ┌───────────────────┐                          │
│  │ 2. Sign Message   │                  │ 2. Email Verify   │                          │
│  │   (Prove Ownership)│                  │    (Magic Link)   │                          │
│  └─────────┬─────────┘                  └─────────┬─────────┘                          │
│            │                                      │                                      │
│            ▼                                      ▼                                      │
│  ┌───────────────────┐                  ┌───────────────────┐                          │
│  │ 3. Address =      │                  │ 3. JWT Token      │                          │
│  │    Identity       │                  │    Issued         │                          │
│  └─────────┬─────────┘                  └─────────┬─────────┘                          │
│            │                                      │                                      │
│            └──────────────────┬───────────────────┘                                      │
│                               │                                                          │
│                               ▼                                                          │
│                    ┌─────────────────────┐                                              │
│                    │   LINK ACCOUNTS     │                                              │
│                    │  (Wallet ↔ Profile) │                                              │
│                    └─────────┬───────────┘                                              │
│                               │                                                          │
└───────────────────────────────┼──────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                              AUTHORIZATION MATRIX                                        │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                          │
│   ┌─────────────────┬────────────────┬────────────────┬────────────────┐               │
│   │     ACTION      │  WALLET ONLY   │ SUPABASE ONLY  │     BOTH       │               │
│   ├─────────────────┼────────────────┼────────────────┼────────────────┤               │
│   │ Upload Photo    │      ✓         │       ✗        │       ✓        │               │
│   │ Save to Chain   │      ✓         │       ✗        │       ✓        │               │
│   │ View Gallery    │      ✓         │       ✗        │       ✓        │               │
│   │ Download Image  │      ✓         │       ✓        │       ✓        │               │
│   │ View History    │      ✗         │       ✓        │       ✓        │               │
│   │ Edit Profile    │      ✗         │       ✓        │       ✓        │               │
│   │ View Analytics  │      ✗         │       ✓        │       ✓        │               │
│   │ Verify Photo    │      ✓         │       ✓        │       ✓        │               │
│   └─────────────────┴────────────────┴────────────────┴────────────────┘               │
│                                                                                          │
└─────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## Diagram 6: Database Entity Relationship Diagram (ERD)

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                         DATABASE ENTITY RELATIONSHIP DIAGRAM                             │
└─────────────────────────────────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                           │
│    ┌─────────────────────┐                           ┌─────────────────────┐            │
│    │    AUTH.USERS       │                           │      PROFILES       │            │
│    │   (Supabase Auth)   │                           │   (Public Schema)   │            │
│    ├─────────────────────┤         1:1               ├─────────────────────┤            │
│    │ • id (PK, UUID)     │◄──────────────────────────│ • id (PK, UUID)     │            │
│    │ • email             │                           │ • user_id (FK) ─────┼──┐         │
│    │ • encrypted_password│                           │ • username (UNIQUE) │  │         │
│    │ • email_confirmed_at│                           │ • full_name         │  │         │
│    │ • created_at        │                           │ • wallet_address    │  │         │
│    │ • updated_at        │                           │ • avatar_url        │  │         │
│    │ • last_sign_in_at   │                           │ • bio               │  │         │
│    └─────────────────────┘                           │ • created_at        │  │         │
│              │                                       │ • updated_at        │  │         │
│              │                                       └─────────────────────┘  │         │
│              │ 1:N                                              │             │         │
│              │                                                  │ 1:N         │         │
│              ▼                                                  ▼             │         │
│    ┌─────────────────────┐                           ┌─────────────────────┐  │         │
│    │     AUDIT_LOGS      │                           │       WALLETS       │  │         │
│    ├─────────────────────┤                           ├─────────────────────┤  │         │
│    │ • id (PK, UUID)     │                           │ • id (PK, UUID)     │  │         │
│    │ • user_id (FK) ─────┼───────────────────────────│ • user_id (FK) ─────┼──┘         │
│    │ • action            │                           │ • address           │            │
│    │ • resource_type     │                           │ • chain_id          │            │
│    │ • resource_id       │                           │ • is_primary        │            │
│    │ • old_data (JSONB)  │                           │ • verified_at       │            │
│    │ • new_data (JSONB)  │                           │ • created_at        │            │
│    │ • ip_address        │                           └─────────────────────┘            │
│    │ • user_agent        │                                                              │
│    │ • metadata (JSONB)  │           ┌─────────────────────┐                           │
│    │ • created_at        │           │       PHOTOS        │                           │
│    └─────────────────────┘           ├─────────────────────┤                           │
│                                      │ • id (PK, UUID)     │                           │
│    ┌─────────────────────┐           │ • user_id (FK) ─────┼───────────────┐           │
│    │      SESSIONS       │           │ • cid               │               │           │
│    ├─────────────────────┤           │ • filename          │               │           │
│    │ • id (PK, UUID)     │           │ • file_size         │               │           │
│    │ • user_id (FK)      │           │ • mime_type         │               │           │
│    │ • device_info       │           │ • tx_hash           │               │           │
│    │ • ip_address        │           │ • chain_id          │               │           │
│    │ • user_agent        │           │ • contract_address  │               │           │
│    │ • created_at        │           │ • block_number      │               │           │
│    │ • last_active_at    │           │ • status            │               │           │
│    │ • expires_at        │           │ • metadata (JSONB)  │               │           │
│    └─────────────────────┘           │ • created_at        │               │           │
│                                      │ • updated_at        │               │           │
│                                      └──────────┬──────────┘               │           │
│                                                 │                          │           │
│                         ┌───────────────────────┼──────────────────────────┘           │
│                         │                       │                                       │
│                         ▼                       ▼                                       │
│           ┌─────────────────────┐    ┌─────────────────────┐                          │
│           │    PHOTO_SHARES     │    │    VERIFICATIONS    │                          │
│           ├─────────────────────┤    ├─────────────────────┤                          │
│           │ • id (PK, UUID)     │    │ • id (PK, UUID)     │                          │
│           │ • photo_id (FK)     │    │ • photo_id (FK)     │                          │
│           │ • shared_by (FK)    │    │ • verified_by (FK)  │                          │
│           │ • shared_with (FK)  │    │ • verification_type │                          │
│           │ • access_level      │    │ • status            │                          │
│           │ • expires_at        │    │ • signature         │                          │
│           │ • created_at        │    │ • metadata (JSONB)  │                          │
│           └─────────────────────┘    │ • created_at        │                          │
│                                      └─────────────────────┘                          │
│                                                                                        │
└────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## Diagram 7: Network Topology & Multi-Chain Support

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                       NETWORK TOPOLOGY & MULTI-CHAIN SUPPORT                             │
└─────────────────────────────────────────────────────────────────────────────────────────┘

                                    ┌─────────────────┐
                                    │   PhotoBlock    │
                                    │    Frontend     │
                                    │  (React + Vite) │
                                    └────────┬────────┘
                                             │
                                             │ wagmi
                                             │
                    ┌────────────────────────┼────────────────────────┐
                    │                        │                        │
                    ▼                        ▼                        ▼
         ┌─────────────────────┐  ┌─────────────────────┐  ┌─────────────────────┐
         │    DEVELOPMENT      │  │      TESTNET        │  │      MAINNET        │
         │                     │  │                     │  │    (Future)         │
         └─────────────────────┘  └─────────────────────┘  └─────────────────────┘
                    │                        │                        │
                    ▼                        ▼                        ▼
┌───────────────────────────┐  ┌───────────────────────────┐  ┌───────────────────────────┐
│                           │  │                           │  │                           │
│   LOCALHOST (Hardhat)     │  │     POLYGON AMOY          │  │     POLYGON MAINNET       │
│                           │  │                           │  │                           │
│   Chain ID: 31337         │  │   Chain ID: 80002         │  │   Chain ID: 137           │
│   RPC: localhost:8545     │  │   RPC: rpc-amoy.polygon   │  │   RPC: polygon-rpc.com    │
│   Symbol: ETH             │  │   Symbol: MATIC           │  │   Symbol: MATIC           │
│   Block Time: Instant     │  │   Block Time: ~2s         │  │   Block Time: ~2s         │
│   Gas: Free               │  │   Gas: ~0.001 MATIC       │  │   Gas: ~0.01 MATIC        │
│                           │  │                           │  │                           │
│   ┌───────────────────┐   │  │   ┌───────────────────┐   │  │   ┌───────────────────┐   │
│   │    Contract       │   │  │   │    Contract       │   │  │   │    Contract       │   │
│   │ 0x5FbDB231...     │   │  │   │ 0x928cD9A5...     │   │  │   │ (Not Deployed)    │   │
│   └───────────────────┘   │  │   └───────────────────┘   │  │   └───────────────────┘   │
│                           │  │                           │  │                           │
│   ┌───────────────────┐   │  │   ┌───────────────────┐   │  │   ┌───────────────────┐   │
│   │   Test Accounts   │   │  │   │    Explorer       │   │  │   │    Explorer       │   │
│   │   10,000 ETH each │   │  │   │ amoy.polygonscan  │   │  │   │   polygonscan.com │   │
│   └───────────────────┘   │  │   └───────────────────┘   │  │   └───────────────────┘   │
│                           │  │                           │  │                           │
└───────────────────────────┘  └───────────────────────────┘  └───────────────────────────┘

                    ┌─────────────────────────────────────────────────┐
                    │               NETWORK DETECTION                  │
                    ├─────────────────────────────────────────────────┤
                    │                                                  │
                    │   const TARGET_CHAIN_ID =                       │
                    │     chain?.id === 31337 ? 31337 :               │
                    │     chain?.id === 80002 ? 80002 :               │
                    │     chain?.id === 137   ? 137   : 31337;        │
                    │                                                  │
                    │   const contractAddress =                        │
                    │     NETWORKS[TARGET_CHAIN_ID].CONTRACT_ADDRESS;  │
                    │                                                  │
                    └─────────────────────────────────────────────────┘

┌───────────────────────────────────────────────────────────────────────────────────────────┐
│                                    RPC FALLBACK SYSTEM                                    │
├───────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                           │
│   Polygon Amoy RPC Endpoints (Fallback Order):                                           │
│                                                                                           │
│   1. https://rpc-amoy.polygon.technology      ◄── Primary (Official)                    │
│   2. https://polygon-amoy-bor-rpc.publicnode.com                                         │
│   3. https://rpc.ankr.com/polygon_amoy                                                   │
│   4. https://polygon-amoy.drpc.org            ◄── Fallback                              │
│                                                                                           │
│   Implementation: FallbackProvider (ethers.js)                                           │
│   • Automatic failover on timeout                                                        │
│   • Load balancing across providers                                                      │
│   • Consensus validation for critical calls                                              │
│                                                                                           │
└───────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## Diagram 8: Security Architecture & Threat Model

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                         SECURITY ARCHITECTURE & THREAT MODEL                             │
└─────────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                                   SECURITY LAYERS                                        │
│                                                                                          │
│    ┌─────────────────────────────────────────────────────────────────────────────────┐  │
│    │                          LAYER 1: FRONTEND SECURITY                              │  │
│    │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐                  │  │
│    │  │   Input         │  │   XSS           │  │   CORS          │                  │  │
│    │  │   Validation    │  │   Prevention    │  │   Headers       │                  │  │
│    │  │                 │  │                 │  │                 │                  │  │
│    │  │ • File type     │  │ • React auto-   │  │ • Strict origin │                  │  │
│    │  │   checking      │  │   escaping      │  │   validation    │                  │  │
│    │  │ • Size limits   │  │ • DOMPurify     │  │ • Credentials   │                  │  │
│    │  │ • CID format    │  │   (if needed)   │  │   control       │                  │  │
│    │  └─────────────────┘  └─────────────────┘  └─────────────────┘                  │  │
│    └─────────────────────────────────────────────────────────────────────────────────┘  │
│                                           │                                              │
│                                           ▼                                              │
│    ┌─────────────────────────────────────────────────────────────────────────────────┐  │
│    │                         LAYER 2: AUTHENTICATION SECURITY                         │  │
│    │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐                  │  │
│    │  │   Web3 Auth     │  │   Supabase      │  │   Session       │                  │  │
│    │  │                 │  │   Auth          │  │   Management    │                  │  │
│    │  │                 │  │                 │  │                 │                  │  │
│    │  │ • Signature     │  │ • JWT tokens    │  │ • Expiry        │                  │  │
│    │  │   verification  │  │ • Refresh       │  │ • Device        │                  │  │
│    │  │ • Address       │  │   rotation      │  │   tracking      │                  │  │
│    │  │   ownership     │  │ • Email verify  │  │ • IP logging    │                  │  │
│    │  └─────────────────┘  └─────────────────┘  └─────────────────┘                  │  │
│    └─────────────────────────────────────────────────────────────────────────────────┘  │
│                                           │                                              │
│                                           ▼                                              │
│    ┌─────────────────────────────────────────────────────────────────────────────────┐  │
│    │                          LAYER 3: BLOCKCHAIN SECURITY                            │  │
│    │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐                  │  │
│    │  │   Smart         │  │   Transaction   │  │   Data          │                  │  │
│    │  │   Contract      │  │   Signing       │  │   Immutability  │                  │  │
│    │  │                 │  │                 │  │                 │                  │  │
│    │  │ • msg.sender    │  │ • MetaMask      │  │ • On-chain      │                  │  │
│    │  │   validation    │  │   approval      │  │   storage       │                  │  │
│    │  │ • No external   │  │ • Gas           │  │ • Audit trail   │                  │  │
│    │  │   calls         │  │   estimation    │  │ • Tamper-proof  │                  │  │
│    │  └─────────────────┘  └─────────────────┘  └─────────────────┘                  │  │
│    └─────────────────────────────────────────────────────────────────────────────────┘  │
│                                           │                                              │
│                                           ▼                                              │
│    ┌─────────────────────────────────────────────────────────────────────────────────┐  │
│    │                           LAYER 4: DATABASE SECURITY                             │  │
│    │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐                  │  │
│    │  │   Row Level     │  │   Encryption    │  │   Audit         │                  │  │
│    │  │   Security      │  │   at Rest       │  │   Logging       │                  │  │
│    │  │                 │  │                 │  │                 │                  │  │
│    │  │ • User can only │  │ • AES-256       │  │ • All actions   │                  │  │
│    │  │   access own    │  │ • TLS 1.3       │  │   logged        │                  │  │
│    │  │   data          │  │   in transit    │  │ • IP recorded   │                  │  │
│    │  │ • Policy-based  │  │                 │  │ • Timestamps    │                  │  │
│    │  └─────────────────┘  └─────────────────┘  └─────────────────┘                  │  │
│    └─────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                          │
└─────────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                                   THREAT MODEL                                           │
├──────────────────┬────────────────────────────────┬─────────────────────────────────────┤
│      THREAT      │          ATTACK VECTOR          │           MITIGATION                │
├──────────────────┼────────────────────────────────┼─────────────────────────────────────┤
│ Private Key      │ Exposed in code/env files      │ .gitignore, env vars, no hardcoding │
│ Exposure         │                                │                                      │
├──────────────────┼────────────────────────────────┼─────────────────────────────────────┤
│ CID Manipulation │ Fake CID injection             │ On-chain verification, signature    │
├──────────────────┼────────────────────────────────┼─────────────────────────────────────┤
│ Session Hijack   │ JWT theft                      │ Short expiry, refresh rotation      │
├──────────────────┼────────────────────────────────┼─────────────────────────────────────┤
│ IPFS Content     │ Malicious file upload          │ File type validation, size limits   │
│ Attack           │                                │                                      │
├──────────────────┼────────────────────────────────┼─────────────────────────────────────┤
│ Replay Attack    │ Reusing old transactions       │ Nonce management, timestamp checks  │
├──────────────────┼────────────────────────────────┼─────────────────────────────────────┤
│ Data Tampering   │ Modifying stored data          │ Blockchain immutability, RLS        │
├──────────────────┼────────────────────────────────┼─────────────────────────────────────┤
│ DoS Attack       │ Flooding with requests         │ Rate limiting, gateway fallback     │
└──────────────────┴────────────────────────────────┴─────────────────────────────────────┘
```

---

## Diagram 9: Deployment Pipeline & CI/CD

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                           DEPLOYMENT PIPELINE & CI/CD                                    │
└─────────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                                    GIT WORKFLOW                                          │
│                                                                                          │
│   ┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐            │
│   │ feature │───►│   dev   │───►│ staging │───►│  main   │───►│  tags   │            │
│   │ branch  │    │ branch  │    │ branch  │    │ branch  │    │ v1.0.0  │            │
│   └─────────┘    └─────────┘    └─────────┘    └─────────┘    └─────────┘            │
│        │              │              │              │              │                  │
│        │              │              │              │              │                  │
│        ▼              ▼              ▼              ▼              ▼                  │
│   ┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐            │
│   │  Local  │    │  Local  │    │ Testnet │    │ Testnet │    │ Mainnet │            │
│   │   Dev   │    │   Dev   │    │  Amoy   │    │  Amoy   │    │ Polygon │            │
│   └─────────┘    └─────────┘    └─────────┘    └─────────┘    └─────────┘            │
│                                                                                          │
└─────────────────────────────────────────────────────────────────────────────────────────┘
                                           │
                                           ▼
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                                CI/CD PIPELINE STAGES                                     │
│                                                                                          │
│  ┌─────────────────────────────────────────────────────────────────────────────────────┐│
│  │ STAGE 1: BUILD & TEST                                                                ││
│  │ ═══════════════════════════════════════════════════════════════════════════════════ ││
│  │                                                                                      ││
│  │   ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐         ││
│  │   │   Install   │───►│   Lint      │───►│   Test      │───►│   Build     │         ││
│  │   │   Deps      │    │   (ESLint)  │    │   (Jest)    │    │   (Vite)    │         ││
│  │   │             │    │             │    │             │    │             │         ││
│  │   │ npm install │    │ npm run     │    │ npm test    │    │ npm run     │         ││
│  │   │             │    │ lint        │    │             │    │ build       │         ││
│  │   └─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘         ││
│  └─────────────────────────────────────────────────────────────────────────────────────┘│
│                                           │                                              │
│                                           ▼                                              │
│  ┌─────────────────────────────────────────────────────────────────────────────────────┐│
│  │ STAGE 2: CONTRACT DEPLOYMENT                                                         ││
│  │ ═══════════════════════════════════════════════════════════════════════════════════ ││
│  │                                                                                      ││
│  │   ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐         ││
│  │   │   Compile   │───►│   Deploy    │───►│   Verify    │───►│   Update    │         ││
│  │   │   Contracts │    │   to Chain  │    │   on        │    │   Config    │         ││
│  │   │             │    │             │    │   Explorer  │    │             │         ││
│  │   │ npx hardhat │    │ npx hardhat │    │ npx hardhat │    │ Update      │         ││
│  │   │ compile     │    │ run deploy  │    │ verify      │    │ Config.json │         ││
│  │   └─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘         ││
│  └─────────────────────────────────────────────────────────────────────────────────────┘│
│                                           │                                              │
│                                           ▼                                              │
│  ┌─────────────────────────────────────────────────────────────────────────────────────┐│
│  │ STAGE 3: FRONTEND DEPLOYMENT                                                         ││
│  │ ═══════════════════════════════════════════════════════════════════════════════════ ││
│  │                                                                                      ││
│  │   ┌─────────────────────────────────────────────────────────────────┐               ││
│  │   │                      DEPLOYMENT OPTIONS                          │               ││
│  │   │                                                                  │               ││
│  │   │   ┌─────────────┐    ┌─────────────┐    ┌─────────────┐        │               ││
│  │   │   │   VERCEL    │    │   NETLIFY   │    │    IPFS     │        │               ││
│  │   │   │             │    │             │    │  (Fleek)    │        │               ││
│  │   │   │ • Auto CI/CD│    │ • Auto CI/CD│    │ • Decentral │        │               ││
│  │   │   │ • Edge CDN  │    │ • Edge CDN  │    │ • Permanent │        │               ││
│  │   │   │ • Previews  │    │ • Functions │    │ • Censorship│        │               ││
│  │   │   │             │    │             │    │   resistant │        │               ││
│  │   │   └─────────────┘    └─────────────┘    └─────────────┘        │               ││
│  │   └─────────────────────────────────────────────────────────────────┘               ││
│  └─────────────────────────────────────────────────────────────────────────────────────┘│
│                                           │                                              │
│                                           ▼                                              │
│  ┌─────────────────────────────────────────────────────────────────────────────────────┐│
│  │ STAGE 4: POST-DEPLOYMENT                                                             ││
│  │ ═══════════════════════════════════════════════════════════════════════════════════ ││
│  │                                                                                      ││
│  │   ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐         ││
│  │   │   Health    │───►│   Smoke     │───►│   Monitor   │───►│   Alert     │         ││
│  │   │   Check     │    │   Tests     │    │   Setup     │    │   Config    │         ││
│  │   │             │    │             │    │             │    │             │         ││
│  │   │ API ping    │    │ E2E tests   │    │ Sentry      │    │ PagerDuty   │         ││
│  │   │ Contract    │    │ Upload flow │    │ Analytics   │    │ Slack       │         ││
│  │   │ check       │    │ Verify flow │    │             │    │             │         ││
│  │   └─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘         ││
│  └─────────────────────────────────────────────────────────────────────────────────────┘│
│                                                                                          │
└─────────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                              ENVIRONMENT CONFIGURATION                                   │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                          │
│  ┌────────────────────┬────────────────────┬────────────────────┬───────────────────┐  │
│  │     VARIABLE        │    DEVELOPMENT     │     STAGING        │    PRODUCTION    │  │
│  ├────────────────────┼────────────────────┼────────────────────┼───────────────────┤  │
│  │ VITE_USE_LOCAL_IPFS│       true         │       false        │      false        │  │
│  │ VITE_PINATA_API_KEY│       N/A          │    test_key        │   prod_key        │  │
│  │ VITE_SUPABASE_URL  │   localhost        │   staging.sb.co    │   prod.sb.co      │  │
│  │ NETWORK            │   localhost:8545   │   amoy             │   polygon         │  │
│  │ CHAIN_ID           │       31337        │      80002         │      137          │  │
│  │ CONTRACT           │   0x5FbDB...       │   0x928cD...       │   (To Deploy)     │  │
│  └────────────────────┴────────────────────┴────────────────────┴───────────────────┘  │
│                                                                                          │
└─────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## Summary: All Diagrams

| # | Diagram Name | Purpose |
|---|-------------|---------|
| 1 | High-Level System Architecture | Overall system components and layers |
| 2 | User Workflow | Step-by-step photo upload and verification |
| 3 | Smart Contract Architecture | Contract functions and storage design |
| 4 | IPFS Storage Flow | Content addressing and distributed storage |
| 5 | Authentication Flow | Web3 + Supabase dual authentication |
| 6 | Database ERD | Entity relationships in PostgreSQL |
| 7 | Network Topology | Multi-chain support and RPC fallback |
| 8 | Security Architecture | Security layers and threat model |
| 9 | Deployment Pipeline | CI/CD stages and environment config |

---

## Usage Notes

These diagrams can be:
- Used directly in Markdown documentation
- Converted to vector graphics using tools like:
  - [Mermaid.js](https://mermaid.js.org/)
  - [PlantUML](https://plantuml.com/)
  - [Draw.io](https://draw.io/)
  - [Excalidraw](https://excalidraw.com/)
- Exported as images for research papers
- Embedded in presentations

For high-resolution versions, consider recreating in Figma, Lucidchart, or similar tools.
